<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>cldetails</title>
<!-- Ícones de Favicon -->
<link rel="icon" type="image/png" sizes="16x16" href="https://github.com/hmdfurniture/hmd-tracking/raw/main/images/Favicon/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://github.com/hmdfurniture/hmd-tracking/raw/main/images/Favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="192x192" href="https://github.com/hmdfurniture/hmd-tracking/raw/main/images/Favicon/android-chrome-192x192.png">
<link rel="icon" type="image/png" sizes="512x512" href="https://github.com/hmdfurniture/hmd-tracking/raw/main/images/Favicon/android-chrome-512x512.png">
<link rel="apple-touch-icon" href="https://github.com/hmdfurniture/hmd-tracking/raw/main/images/Favicon/apple-touch-icon.png">

<style>
.back-button {
    display: inline-block;
    margin-top: 20px;
    font-size: 18px;
    text-decoration: none;
    color: black; /* Muda a cor do link para preto */
    background-color: transparent;
    border: none;
    cursor: pointer;
}
.back-button:hover {
    text-decoration: underline;
}
.back-icon {
    margin-right: 10px;
}
/* Ajustar o tamanho do logo */
.logo {
    max-width: 150px; /* Define a largura máxima */
    max-width: 350px; /* Define a largura máxima */
    height: auto; /* Mantém a proporção */
}
</style>
</head>
<body>
<div class="container">
    <div class="logo-container">
        <img src="images/logo.jpg" alt="Logo HMD" class="logo">
        <h1></h1>
    </div>

    <div id="conteudo">
        <!-- O conteúdo será carregado dinamicamente aqui -->
    </div>

    <!-- Seta de retorno à página principal -->
    <a href="index.html" class="back-button">
        <span class="back-icon">←</span> Back
    </a>
</div>

<script>
function obterCodigoDaURL() {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get('codigo');
}

function carregarConteudo() {
    const codigo = obterCodigoDaURL();

    if (!codigo) {
        alert("Código não encontrado. Verifique a URL.");
        document.getElementById("conteudo").innerHTML = `
            <p><strong>Código não encontrado.</strong></p>
            <a href="/" class="back-button">
                <span class="back-icon">←</span> Voltar à Página Principal
            </a>
        `;
        return; // Não carrega o conteúdo
    }

    const conteudoUrls = [
        `conteudo/${codigo}/FLDados.txt`,
        `conteudo/${codigo}/FT2Dados.txt`,
        `conteudo/${codigo}/FT3Dados.txt`,
        `conteudo/${codigo}/FTDados.txt`,
        `conteudo/${codigo}/SZADRS_Dados.txt`,
        `conteudo/${codigo}/AGDados.txt`
    ];
    const imagemUrlFt2 = `conteudo/${codigo}/image_ft2dados.jpg`;
    const imagemUrlAg = `conteudo/${codigo}/image_agdados.jpg`;
    const imagemUrlFl = `conteudo/${codigo}/image_fldados.jpg`;

    Promise.all([
        ...conteudoUrls.map(url => fetch(url).then(response => response.ok ? response.text() : Promise.resolve(`${url.split('/').pop()} não encontrado.`))),
        fetch(imagemUrlFt2).then(response => response.ok ? response.blob() : Promise.resolve(null)),
        fetch(imagemUrlAg).then(response => response.ok ? response.blob() : Promise.resolve(null)),
        fetch(imagemUrlFl).then(response => response.ok ? response.blob() : Promise.resolve(null))
    ])
    .then(([
        dadosFL, dadosFT2, dadosFT3, dadosFT, dadosSZADRS, dadosAG, imagemFt2, imagemAg, imagemFl
    ]) => {
        const dados1 = processarConteudo(dadosFL, 'FL');
        const dados2 = processarConteudo(dadosFT2, 'FT2');
        const dados3 = processarConteudo(dadosFT3, 'FT3');
        const dados4 = processarConteudo(dadosFT, 'FT');
        const dados5 = processarConteudo(dadosSZADRS, 'SZADRS');
        const dados6 = processarConteudo(dadosAG, 'AG');

        let imagemFt2HTML = '';
        if (imagemFt2) {
            const imagemURLFt2 = URL.createObjectURL(imagemFt2);
            imagemFt2HTML = `<img src="${imagemURLFt2}" alt="Imagem FT2Dados" style="max-width: 100%; max-height: 200px; margin-top: 20px;">`;
        }

        let imagemAgHTML = '';
        if (imagemAg) {
            const imagemURLAg = URL.createObjectURL(imagemAg);
            imagemAgHTML = `<img src="${imagemURLAg}" alt="Imagem AGDados" style="max-width: 100%; max-height: 200px; margin-top: 20px;">`;
        }

        let imagemFlHTML = '';
        if (imagemFl) {
            const imagemURLFl = URL.createObjectURL(imagemFl);
            imagemFlHTML = `<img src="${imagemURLFl}" alt="Imagem FLDados" style="max-width: 100%; max-height: 200px; margin-top: 20px;">`;
        }

        exibirDados(dados1, dados2, dados3, dados4, dados5, dados6, imagemFt2HTML, imagemAgHTML, imagemFlHTML);
    })
    .catch(error => {
        alert("Ocorreu um erro ao carregar o conteúdo.");
        console.error("Error loading content:", error); // Avoid logging sensitive details
    });
}

function exibirDados(dados1, dados2, dados3, dados4, dados5, dados6, imagemFt2HTML, imagemAgHTML, imagemFlHTML) {
    const conteudoDiv = document.getElementById("conteudo");

    conteudoDiv.innerHTML = `
      <h2>Merchandise details</h2>
      <ul>
          <li>Expected Delivery Date: ${dados3.dataEntrega}</li>
          <!-- 1 por linha -->
          <li>Shipment Date: ${dados4.dataExpedicao}</li>
          <!-- Lado a lado com verificação de valores -->
          <li style="display: inline-block; margin-right: 20px;" 
              ${!camposOcultar['m3'](dados2.m3) ? '' : 'style="display: none;"'}>
              m3: ${dados2.m3}
          </li>
          <li style="display: inline-block; margin-right: 20px;" 
              ${!camposOcultar['ldm'](dados2.ldm) ? '' : 'style="display: none;"'}>
              Ldm: ${dados2.ldm}
          </li>
          <!-- 1 por linha -->
          <li>Country of destination: ${dados2.zonaExpedicao}</li>
          <li>No. of volumes/packages: ${dados2.volumesExpedir}</li>
          <li>Weight: ${dados2.peso}</li>
          <li>Order Nr.: ${dados4.nrEncomenda}</li>
      </ul>
      ${imagemFt2HTML} <!-- Aqui você exibe a imagem FT2Dados -->
      
      <h2>Carrier at origin</h2>
      <ul>
          <li>${dados1.nomeExpedidor}</li>
          <li>${dados1.moradaExpedidor}</li>
          <li>${dados1.localExpedidor}</li>
          <li>${dados1.codigoPostal}</li>
          <li>${dados1.telefoneExpedidor}</li>
          <li>${dados1.emailExpedidor}</li>
          <li>Reference: ${dados2.numeroReserva}</li>
      </ul>
      ${imagemFlHTML} <!-- Aqui você exibe a imagem FLDados -->

      <h2>Carrier at destination</h2>
      <ul>
          <li>${dados6.nrCliente}</li>
          <li>${dados6.nomeCliente}</li>
          <li>${dados6.morada}</li>
          <li>${dados6.local}</li>
          <li>${dados6.codigoPostal}</li>
          <li>${dados6.pais}</li>
          <li><a href="tel:${dados6.telefone}">${dados6.telefone}</a></li>
          <li><a href="mailto:${dados6.email}">${dados6.email}</a></li>
          <li>${removerProtocolo(dados6.url)}</li>
          <li>Carrier at origin Reference: ${dados2.numeroReserva}</li>
      </ul>
      ${imagemAgHTML} <!-- Aqui você exibe a imagem AGDados -->

      <h2>Client</h2>
      <ul>
          <li>Nr.: ${dados4.nrCliente}</li>
          <li>Name: ${dados4.nomeCliente}</li>
      </ul>

      <h2>Delivery address</h2>
      <ul>
          <li>Descrição: ${dados5.descricaoEntrega}</li>
          <li>Name: ${dados5.nomeEntrega}</li>
          <li>Address: ${dados5.moradaEntrega}</li>
          <li>Local: ${dados5.localEntrega}</li>
          <li>Zip Code: ${dados5.codigoPostalEntrega}</li>
          <li>Country: ${dados5.paisEntrega}</li>
          <li>Contact Name: ${dados5.nomeContatoEntrega}</li>
          <li>Telephone: <a href="tel:${dados5.telefoneEntrega}">${dados5.telefoneEntrega}</a></li>
          <li>Email: <a href="mailto:${dados5.emailEntrega}">${dados5.emailEntrega}</a></li>
          <li>Obs: ${dados5.observacaoEntrega}</li>
      </ul>
  `;
}

// Carregar os dados assim que a página for carregada
window.onload = carregarConteudo;
</script>
</body>
</html>
