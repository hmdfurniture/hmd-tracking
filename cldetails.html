<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>cldetails</title>
<!-- Ícones de Favicon -->
<link rel="icon" type="image/png" sizes="16x16" href="images/Favicon/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="images/Favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="192x192" href="images/Favicon/android-chrome-192x192.png">
<link rel="icon" type="image/png" sizes="512x512" href="images/Favicon/android-chrome-512x512.png">
<link rel="apple-touch-icon" href="images/Favicon/apple-touch-icon.png">

<style>
.back-button {
    display: inline-block;
    margin-top: 20px;
    font-size: 18px;
    text-decoration: none;
    color: black; /* Muda a cor do link para preto */
    background-color: transparent;
    border: none;
    cursor: pointer;
}
.back-button:hover {
    text-decoration: underline;
}
.back-icon {
    margin-right: 10px;
}
/* Ajustar o tamanho do logo */
.logo {
    max-width: 150px; /* Define a largura máxima */
    height: auto; /* Mantém a proporção */
}
</style>
</head>
<body>
<div class="container">
    <div class="logo-container">
        <img src="images/logo.jpg" alt="Logo HMD" class="logo">
        <h1></h1>
    </div>

    <div id="conteudo">
        <!-- O conteúdo será carregado dinamicamente aqui -->
    </div>

    <!-- Seta de retorno à página principal -->
    <a href="index.html" class="back-button">
        <span class="back-icon">←</span> Back
    </a>
</div>

<script>
function obterCodigoDaURL() {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get('codigo');
}

function processarConteudo(dados, tipo) {
    console.log(`Processing ${tipo} data:`, dados);
    // Example processing logic based on the 'tipo'
    // This function should return the processed data
    // Modify this function based on your actual processing logic
    return dados ? dados : `${tipo} dados não encontrados.`;
}

function removerProtocolo(url) {
    // This function removes the protocol (http:// or https://) from a URL
    return url ? url.replace(/^https?:\/\//, '') : '';
}

async function carregarConteudo() {
    const codigo = obterCodigoDaURL();

    if (!codigo) {
        alert("Código não encontrado. Verifique a URL.");
        document.getElementById("conteudo").innerHTML = `
            <p><strong>Código não encontrado.</strong></p>
            <a href="/" class="back-button">
                <span class="back-icon">←</span> Voltar à Página Principal
            </a>
        `;
        return; // Não carrega o conteúdo
    }

    const conteudoUrls = [
        `conteudo/${codigo}/FLDados.txt`,
        `conteudo/${codigo}/FT2Dados.txt`,
        `conteudo/${codigo}/FT3Dados.txt`,
        `conteudo/${codigo}/FTDados.txt`,
        `conteudo/${codigo}/SZADRS_Dados.txt`,
        `conteudo/${codigo}/AGDados.txt`
    ];

    const imagemUrls = {
        ft2: `conteudo/${codigo}/image_ft2dados.jpg`,
        ag: `conteudo/${codigo}/image_agdados.jpg`,
        fl: `conteudo/${codigo}/image_fldados.jpg`
    };

    try {
        const dados = await Promise.all(
            conteudoUrls.map(url => 
                fetch(url).then(response => {
                    console.log(`Fetching ${url}:`, response.ok ? 'Success' : 'Failed');
                    return response.ok ? response.text() : Promise.resolve(`${url.split('/').pop()} não encontrado.`);
                })
            )
        );

        const imagens = await Promise.all(
            Object.values(imagemUrls).map(url => 
                fetch(url).then(response => {
                    console.log(`Fetching ${url}:`, response.ok ? 'Success' : 'Failed');
                    return response.ok ? response.blob() : Promise.resolve(null);
                }).catch(() => Promise.resolve(null))
            )
        );

        const [dadosFL, dadosFT2, dadosFT3, dadosFT, dadosSZADRS, dadosAG] = dados;
        console.log({ dadosFL, dadosFT2, dadosFT3, dadosFT, dadosSZADRS, dadosAG });

        const [imagemFt2, imagemAg, imagemFl] = imagens;

        const dados1 = processarConteudo(dadosFL, 'FL');
        const dados2 = processarConteudo(dadosFT2, 'FT2');
        const dados3 = processarConteudo(dadosFT3, 'FT3');
        const dados4 = processarConteudo(dadosFT, 'FT');
        const dados5 = processarConteudo(dadosSZADRS, 'SZADRS');
        const dados6 = processarConteudo(dadosAG, 'AG');
        console.log({ dados1, dados2, dados3, dados4, dados5, dados6 });

        let imagemFt2HTML = '';
        if (imagemFt2 && dados2) {
            const imagemURLFt2 = URL.createObjectURL(imagemFt2);
            imagemFt2HTML = `<img src="${imagemURLFt2}" alt="Imagem FT2Dados" style="max-width: 100%; max-height: 200px; margin-top: 20px;">`;
        }

        let imagemAgHTML = '';
        if (imagemAg && dados6) {
            const imagemURLAg = URL.createObjectURL(imagemAg);
            imagemAgHTML = `<img src="${imagemURLAg}" alt="Imagem AGDados" style="max-height: 42px; width: auto;">`;
        }

        let imagemFlHTML = '';
        if (imagemFl && dados1) {
            const imagemURLFl = URL.createObjectURL(imagemFl);
            imagemFlHTML = `<img src="${imagemURLFl}" alt="Imagem FLDados" style="max-height: 42px; width: auto;">`;
        }

        exibirDados(dados1, dados2, dados3, dados4, dados5, dados6, imagemFt2HTML, imagemAgHTML, imagemFlHTML);
    } catch (error) {
        alert("Ocorreu um erro ao carregar o conteúdo.");
        console.error("Error loading content:", error); // Check the error details in the browser console
    }
}

function exibirDados(dados1, dados2, dados3, dados4, dados5, dados6, imagemFt2HTML, imagemAgHTML, imagemFlHTML) {
    console.log('Exibindo dados:', { dados1, dados2, dados3, dados4, dados5, dados6 });

    const conteudoDiv = document.getElementById("conteudo");

    const getValue = (data, key) => {
        if (data && data.includes(key)) {
            return data.split('\n').find(line => line.includes(key)).split(':')[1].trim();
        }
        return 'Not available';
    };

    const m3HTML = dados2 && !dados2.includes('m3: 0,00') ? `<li style="display: inline-block; margin-right: 20px;">m3: ${getValue(dados2, 'm3:')}</li>` : '';
    const ldmHTML = dados2 && !dados2.includes('Ldm: 0,00') ? `<li style="display: inline-block; margin-right: 20px;">Ldm: ${getValue(dados2, 'Ldm:')}</li>` : '';

    conteudoDiv.innerHTML = `
        <h2>Merchandise details</h2>
        <ul>
            <li>Expected Delivery Date: ${getValue(dados3, 'Data Entrega:')}</li>
            <li>Shipment Date: ${getValue(dados4, 'Data Expedição:')}</li>
            ${m3HTML}
            ${ldmHTML}
            <li>Country of destination: ${getValue(dados2, 'Zona Expedição:')}</li>
            <li>No. of volumes/packages: ${getValue(dados2, 'Volumes a expedir:')}</li>
            <li>Weight: ${getValue(dados2, 'Peso:')}</li>
            <li>Order Nr.: ${getValue(dados4, 'Nr. Encomenda:')}</li>
        </ul>
        ${imagemFt2HTML} <!-- Aqui você exibe a imagem FT2Dados -->

        <h2>Carrier at origin</h2>
        ${imagemFlHTML} <!-- Aqui você exibe a imagem FLDados -->
        <ul>
            <li>${getValue(dados1, 'Nome Expedidor Origem:')}</li>
            <li>${getValue(dados1, 'Morada Expedidor Origem:')}</li>
            <li>${getValue(dados1, 'Local Expedidor Origem:')}</li>
            <li>${getValue(dados1, 'Código Postal Expedidor Origem:')}</li>
            <li>${getValue(dados1, 'Telefone Expedidor Origem:')}</li>
            <li>${getValue(dados1, 'Email Expedidor Origem:')}</li>
            <li>Reference: ${getValue(dados2, 'Nr. Reserva:')}</li>
        </ul>

        <h2>Carrier at destination</h2>
        ${imagemAgHTML} <!-- Aqui você exibe a imagem AGDados -->
        <ul>
            <li>${getValue(dados6, 'Nr. Cliente:')}</li>
            <li>${getValue(dados6, 'Nome Cliente:')}</li>
            <li>${getValue(dados6, 'Morada:')}</li>
            <li>${getValue(dados6, 'Local:')}</li>
            <li>${getValue(dados6, 'Código Postal:')}</li>
            <li>${getValue(dados6, 'País:')}</li>
            <li><a href="tel:${getValue(dados6, 'Telefone:')}">${getValue(dados6, 'Telefone:')}</a></li>
            <li><a href="mailto:${getValue(dados6, 'Email:')}">${getValue(dados6, 'Email:')}</a></li>
            <li>${removerProtocolo(getValue(dados6, 'URL:'))}</li>
            <li>Carrier at origin Reference: ${getValue(dados2, 'Nr. Reserva:')}</li>
        </ul>

        <h2>Client</h2>
        <ul>
            <li>Nr.: ${getValue(dados4, 'Nr. Cliente:')}</li>
            <li>Name: ${getValue(dados4, 'Nome Cliente:')}</li>
        </ul>

        <h2>Delivery address</h2>
        <ul>
            <li>Descrição: ${getValue(dados5, 'Descrição da entrega:')}</li>
            <li>Name: ${getValue(dados5, 'Nome da entrega:')}</li>
            <li>Address: ${getValue(dados5, 'Morada da entrega:')}</li>
            <li>Local: ${getValue(dados5, 'Local da entrega:')}</li>
            <li>Zip Code: ${getValue(dados5, 'Código Postal da entrega:')}</li>
            <li>Country: ${getValue(dados5, 'País da entrega:')}</li>
            <li>Contact Name: ${getValue(dados5, 'Nome Contacto da entrega:')}</li>
            <li>Telephone: <a href="tel:${getValue(dados5, 'Telefone da entrega:')}">${getValue(dados5, 'Telefone da entrega:')}</a></li>
            <li>Email: <a href="mailto:${getValue(dados5, 'Email da entrega:')}">${getValue(dados5, 'Email da entrega:')}</a></li>
            <li>Obs: ${getValue(dados5, 'Observação da entrega:')}</li>
        </ul>
    `;
}

// Carregar os dados assim que a página for carregada
window.onload = carregarConteudo;
</script>
</body>
</html>
